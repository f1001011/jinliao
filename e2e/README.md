# COKFOOD 产品需求文档 (移动端)

## 1. 产品概述

COKFOOD是一个外卖服务平台，提供商家展示、菜单浏览、订单处理和支付功能。系统采用三级权限管理架构，包括管理员、区域代理和分销商，以及普通用户。本产品的核心业务模式是通过分销商生成代付链接，邀请他人为其支付餐饮费用，从而获取佣金。

### 1.1 产品定位

COKFOOD定位为一个移动优先的外卖平台，通过精美的UI设计和流畅的用户体验，为用户提供便捷的餐饮浏览和订购服务，并为分销商提供赚取佣金的机会。

### 1.2 产品目标

- 为普通用户提供浏览餐厅和菜品的平台，但不支持直接下单
- 为分销商提供设置折扣价格并生成代付链接的功能
- 为受邀付款方提供简洁明了的支付流程
- 为区域代理提供管理分销商的工具
- 为管理员提供全平台的管理和监控能力

## 2. 用户角色与权限

### 2.1 用户角色定义

| 角色       | 描述                                                               |
| ---------- | ------------------------------------------------------------------ |
| 管理员     | 平台最高权限，负责整体平台管理，包括商家、商品、用户管理及数据分析 |
| 区域代理   | 负责特定地理区域内的经销商管理，设置区域内佣金比例，审核提现申请   |
| 分销商     | 直接面向终端用户，设置商品折扣价格，生成代付链接，获取佣金收益     |
| 普通用户   | 浏览商品，无法直接下单（系统始终返回"不在配送区域"错误）           |
| 受邀付款方 | 通过分销商代付链接访问系统，查看商品信息并完成支付                 |

### 2.2 权限对比

| 功能模块 | 管理员       | 区域代理       | 分销商       | 普通用户 |
| -------- | ------------ | -------------- | ------------ | -------- |
| 系统管理 | 完全控制     | 无权限         | 无权限       | 无权限   |
| 商户管理 | 完全控制     | 无权限         | 无权限       | 无权限   |
| 产品管理 | 完全控制     | 无权限         | 仅浏览       | 仅浏览   |
| 订单管理 | 全平台订单   | 区域内订单     | 个人相关订单 | 无权限   |
| 用户管理 | 全平台用户   | 区域内经销商   | 无权限       | 无权限   |
| 佣金设置 | 全局设置     | 区域内设置     | 个人折扣设置 | 无权限   |
| 财务管理 | 全平台财务   | 区域内财务     | 个人财务     | 无权限   |
| 数据分析 | 全平台数据   | 区域数据       | 个人数据     | 无权限   |
| 链接管理 | 查看所有链接 | 查看区域内链接 | 个人链接管理 | 无权限   |

## 3. 功能需求

### 3.1 首页功能

#### 3.1.1 首页布局

- 顶部导航栏：包含Logo、地址选择器、搜索框及用户操作区
- 轮播英雄区：展示促销活动或特色餐厅
- 食品分类区：展示不同类别的食品图标和名称（如全部、汉堡、披萨、健康食品、鸡肉、甜点、咖啡、海鲜等）
- 特色餐厅区：展示4-8家推荐餐厅，包含餐厅图片、名称、配送信息和标签
- 热门菜品区：展示多个热门菜品，包含图片、名称、价格、餐厅名称和评分
- "如何工作"区域：简要说明平台使用流程
- 用户评价区：展示用户对平台的评价
- 底部区域：包含Logo、企业文化、社交媒体链接和版权信息

#### 3.1.2 交互效果

- 导航栏滚动效果：滚动时添加阴影并变为半透明
- 分类项悬停动画：向上移动并添加阴影
- 餐厅卡片悬停效果：轻微上移并增加阴影
- 图片悬停放大效果：鼠标悬停时图片轻微放大
- 按钮悬停动画：添加波纹效果

#### 3.1.3 商家浏览与选择

- 用户无需登录即可访问首页，浏览可用的餐厅和商家
- 首页展示精选商家列表，每个商家卡片包含：
  - 餐厅图片
  - 餐厅名称
  - 配送信息（如"免费配送"）
  - 特色菜品标签
  - "立即订购"按钮
- 每个商家卡片点击后进入该商家的菜单页面

### 3.2 商家详情页面

#### 3.2.1 页面布局

- 顶部餐厅封面图：大型餐厅形象图片，底部有渐变遮罩
- 餐厅基本信息：名称、类别标签
- 菜单分类导航：如热门菜品、前菜、汤类、主菜等
- 菜品列表：按分类组织的菜品卡片
- 客户评价区域
- 底部区域

#### 3.2.2 菜单浏览与商品选择

- 商家页面顶部显示商家基本信息
- 菜单按分类组织（如前菜、主菜、饮料等），支持分类间快速切换
- 每个商品项包含：
  - 菜品图片
  - 名称
  - 价格（右上角标注）
  - 简短描述
  - 人气标签（如适用）
  - 评分和评价数量
  - "立即订购"按钮
- 支持商品搜索和筛选
- 点击商品卡片可查看详情

#### 3.2.3 客户评价区域

- 显示餐厅总体评分和评价数量
- 显示评分分布（5星到1星的百分比直观展示）
- 展示具体客户评价，包含：
  - 客户头像（圆形设计）
  - 客户姓名
  - 星级评分（1-5星）
  - 评价时间（格式化展示）
  - 评价内容
- 支持"查看更多评价"功能，点击加载更多历史评价
- 评分统计图表采用水平条形图样式展示各评分占比
- 使用星形图标直观表示评分，支持小数评分（如4.5星）
- 评价区采用卡片式设计，提升视觉层次感
- 整体设计与页面风格统一，使用一致的配色方案
- 整个评价区域采用响应式设计，在不同屏幕尺寸下保持良好的可读性

### 3.3 商品详情页

#### 3.3.1 页面布局

- 商品图片区：主图和缩略图滑块
- 商品信息区：名称、评分、价格、描述
- 数量选择器
- 操作按钮区："支付"、"分享"和"收藏"
- "邀请代付"按钮
- 商品详情标签页：描述、配料、评价
- 相关推荐区
- 评论区：评分概览和具体评价

#### 3.3.2 商品详情展示

- 显示高清商品图片，支持多图滑动查看
- 缩略图滑块允许快速预览和切换图片
- 显示商品名称、评分、评价数量、价格
- 详细描述商品特点和口味
- 提供营养与过敏原信息（如卡路里、蛋白质含量、过敏原等）
- 提供辣度选择选项（如温和、中等、辣、特辣等）
- 数量选择器，可增减购买数量
- 显示"支付"、"分享"和"收藏"按钮
- 突出显示"邀请代付"按钮

#### 3.3.3 商品详情标签页

- "描述"标签：详细介绍商品的特点、制作方法等
- "配料"标签：列出商品的所有配料
- "评价"标签：显示用户对该商品的评价

#### 3.3.4 评论区域

- 评分概览：平均分和评分分布
- 具体评价列表，每条评价包含：
  - 用户名
  - 评分
  - 评价时间
  - 评价内容
- "加载更多评价"按钮

#### 3.3.5 相关推荐

- 展示4-5个相关商品，每个包含：
  - 商品图片
  - 商品名称
  - 简短描述
  - 价格
  - 评分
  - "查看"链接

### 3.4 订单填写页面

#### 3.4.1 页面布局

- 配送地址表单
- 付款方式选择
- 订单备注
- 订单摘要（右侧或底部）
- 提交订单按钮

#### 3.4.2 配送地址表单

- 收货地址表单，包含以下字段：
  - 名字和姓氏
  - 电话号码
  - 电子邮件
  - 详细地址（第1行）
  - 详细地址（第2行，可选）
  - 城市
  - 州/省
  - 邮政编码
  - 配送说明（可选）
- 所有必填字段有明确标记

#### 3.4.3 付款方式

- 支持PayPal支付

#### 3.4.4 订单摘要

- 显示已选商品信息（图片、名称、价格、数量）
- 费用明细：
  - 商品小计
  - 配送费
  - 税费
  - 服务费
  - 总计金额
- 优惠码输入框和应用按钮
- 配送时间估计
- 可能感兴趣的其他餐厅推荐

#### 3.4.5 "不在配送区域"提示

- 无论用户输入何种地址，点击"提交订单"后，系统都会显示一个模态框，提示：
  - "不在配送区域"的错误信息
  - 说明"您的地址不在我们的配送范围内"
  - 提供"修改地址"选项，返回地址填写页面
- 模态框设计醒目，包含图标和清晰的错误说明
- "修改地址"按钮点击后关闭模态框并聚焦到地址输入框

### 3.5 登录和注册页面

#### 3.5.1 页面布局

- 顶部LOGO区域：展示平台标识
- 标签切换区：在登录和注册表单之间切换
- 表单区域：根据所选标签显示对应的表单
- 社交媒体登录按钮：提供第三方账号登录选项
- 返回首页链接：位于页面底部

#### 3.5.2 登录表单

- 电子邮箱输入框：带有邮箱图标和验证功能
- 密码输入框：带有密码图标和显示/隐藏切换功能
- "忘记密码"链接：引导用户重置密码
- 登录按钮：提交表单，包含加载状态
- "使用其他方式继续"分隔线：引导用户选择社交媒体登录
- 社交媒体登录选项：Google和Facebook登录按钮

#### 3.5.3 注册表单

- 姓名输入框：带有用户图标
- 电子邮箱输入框：带有邮箱图标和验证功能
- 密码输入框：带有密码图标和显示/隐藏切换功能
- 确认密码输入框：验证两次密码输入是否一致
- "同意条款"复选框：链接到服务条款和隐私政策
- 注册按钮：提交表单，包含加载状态

#### 3.5.4 特殊用户登录

- 支持分销商专用登录入口
- 使用邮箱distributor@example.com和密码password可登录为分销商
- 普通用户和分销商登录后重定向到不同的页面
- 登录状态保存在本地存储中，支持会话持久化

#### 3.5.5 交互设计

- 表单验证：实时验证输入内容的正确性
- 错误提示：显示清晰的错误信息
- 密码强度指示：注册时显示密码强度
- 加载状态：提交表单时显示加载动画
- 平滑过渡：标签切换和表单提交时有动画效果
- 响应式设计：适应不同设备屏幕尺寸

### 3.6 个人中心页面

#### 3.6.1 页面布局

- 用户信息卡片：展示用户头像、姓名、邮箱和角色标签
- 账户操作菜单：包含订单管理、地址管理和支付方式管理
- 分销商专属功能区（分销商角色可见）：包含仪表盘、支付链接和提现管理
- 代理专属功能区（代理角色可见）：包含代理仪表盘
- 设置菜单：包含通知、隐私和帮助与支持
- 登出按钮：位于页面底部

#### 3.6.2 用户状态展示

- 未登录状态：显示登录提示和登录/注册按钮
- 已登录状态：根据用户角色显示不同的功能菜单
- 用户角色标签：使用不同颜色区分普通用户、分销商和代理
- 编辑资料按钮：点击打开编辑个人资料模态框

#### 3.6.3 功能菜单

- 菜单项设计：采用卡片式布局，包含图标、标题和简短描述
- 视觉区分：不同类别的菜单使用不同的图标颜色
- 分销商功能：使用特殊颜色标识分销商专属功能
- 代理功能：使用特殊颜色标识代理专属功能

#### 3.6.4 编辑个人资料

- 模态框设计：半透明背景遮罩，突出显示编辑表单
- 头像上传：支持选择本地图片，预览效果
- 表单字段：姓名、电子邮箱（不可修改）和电话号码
- 取消和保存按钮：明确的操作反馈
- 表单验证：实时验证输入内容的正确性

#### 3.6.5 交互设计

- 菜单项点击效果：轻微背景色变化和波纹效果
- 图标使用：每个功能菜单项配有直观的图标
- 角色标签：使用圆角胶囊形状，不同角色使用不同颜色
- 登出确认：点击登出按钮前提供确认提示
- 模态框过渡：平滑的淡入淡出动画

### 3.7 分销商商品详情页

#### 3.7.1 页面布局

- 与普通商品详情页基本相同，但增加分销商特有功能
- 顶部添加分销商提示横幅
- 商品信息区增加"生成代付链接"按钮
- 价格旁显示"可设置折扣"提示

#### 3.7.2 分销商特有功能

- 顶部显示"分销商模式已激活"的提示横幅
- 导航栏右侧显示"分销商"标识
- 商品价格旁显示"可设置折扣"图标
- 商品详情底部显示"生成代付链接"按钮，样式醒目
- 底部添加分销商信息提示框，说明分销商可设置折扣价格并获取佣金

#### 3.7.3 折扣设置模态框

- 点击"生成代付链接"按钮后弹出
- 显示商品基本信息（图片、名称、原价）
- 提供折扣价格设置功能：
  - 价格输入框
  - 价格滑动条（可拖动调整）
  - 最低和最高价格显示
- 实时计算并显示预计佣金金额（基于设定佣金比例）
- 个性化名称设置输入框（用于在代付页面显示"您正在帮助[名称]支付外卖"）
- "生成支付链接"按钮

#### 3.6.4 链接生成成功模态框

- 显示成功提示和图标
- 显示生成的支付链接（可复制）
- 显示支付链接的二维码
- 提供"分享"和"完成"按钮
- 分享功能支持复制链接或使用系统分享功能

### 3.8 代付页面

#### 3.8.1 页面布局

- 顶部帮助付款横幅（醒目显示"您正在帮助[名称]支付外卖"）
- 商品信息区（图片、名称、描述、原价和折扣价）
- 数量选择器
- 订单摘要（商品、数量、总价）
- 支付按钮（PayPal）
- 安全支付信息
- 餐厅和支付安全信息区域

#### 3.8.2 帮助付款横幅

- 使用渐变背景色（如红色渐变）
- 包含心形图标动画
- 醒目显示"您正在帮助[名称]支付食物"的文字
- 简短说明文字："您的慷慨意义重大！完成支付帮助[名称]享用美食。"

#### 3.8.3 商品信息展示

- 高质量商品图片
- 商品名称（大号字体）
- 商品评分和评价数量
- 价格信息：
  - 折扣价（大号字体，醒目显示）
  - 原价（显示为划线价格）
  - 节省金额提示（如"节省$3.00"）
- 商品详细描述

#### 3.8.4 数量选择和订单摘要

- 数量选择器（减号、数量显示、加号）
- 订单摘要卡片，包含：
  - 商品名称和数量
  - 商品总价
  - 配送费（显示为$0.00）
  - 总计金额（醒目显示）
- 价格随数量变化实时更新

#### 3.8.5 支付按钮和安全信息

- 醒目的PayPal支付按钮（带轻微脉动动画效果）
- PayPal图标和文字
- 支付安全提示，包含锁图标和"安全支付处理由PayPal提供"的文字
- 感谢信息卡片，说明支付将被安全处理，接收方会立即收到通知

#### 3.8.6 其他信息区域

- 关于餐厅的简介
- 配送时间估计
- 支付安全说明
- 不需要用户填写任何配送地址信息

#### 3.8.7 支付成功模态框

- 成功图标和动画
- "支付成功！"标题
- 感谢信息："感谢您帮助[名称]！您的支付已成功处理。"
- 订单总金额显示
- 通知信息："[名称]已收到您的支付通知。餐厅将立即开始准备订单。"
- "完成"按钮

### 3.9 不在配送区域错误页面

#### 3.9.1 页面布局

- 面包屑导航
- 错误信息区域（左侧）
- 地图可视化（右侧）
- 底部区域

#### 3.9.2 错误信息区域

- 错误图标（感叹号图标）
- "不在配送区域"标题
- 错误说明："很抱歉，您的地址不在我们当前的配送范围内。请尝试使用其他地址或考虑使用我们的'邀请代付'功能让他人为您的订单付款。"
- "返回餐厅"按钮

#### 3.9.3 地图可视化

- 简化地图显示配送区域和用户位置
- 配送区域显示为圆形边界
- 餐厅位置显示在中心（带动画效果）
- 用户位置显示在圆形边界外
- 地图图例说明各个标记的含义

### 3.10 分销商系统

#### 3.10.1 分销商注册与登录

- 分销商由管理员指定，线下添加账户
- 分销商使用管理员提供的账户信息登录系统
- 登录成功后，系统会在顶部导航栏显示分销商标识

#### 3.10.2 分销商价格设置

- 分销商登录后，商品详情页显示"设置折扣"选项
- 折扣设置界面包含：
  - 原价显示
  - 折扣价格输入框（不得高于原价）
  - 折扣价格滑动条（视觉化调整价格）
  - 预计佣金计算（实时显示）
  - 个性化名称设置（显示为"您正在帮助[名称]支付外卖"）
  - 保存按钮
- 系统验证折扣价格（不低于管理员设定的最低价格限制）
- 折扣设置成功后，生成唯一代付链接
- 提供链接预览功能
- 支持通过复制链接或生成二维码分享

#### 3.10.3 代付链接管理

- 在分销商后台显示所有已生成的代付链接
- 每个链接项包含：
  - 商品图片和信息
  - 原价和折扣价
  - 创建时间
  - 使用次数
  - 设置的名称
  - 链接状态（启用/禁用）
- 支持链接的复制、分享
- 支持链接的停用/启用
- 支持查看链接支付状态和历史

#### 3.10.4 分销商后台管理

##### 3.10.4.1 后台概览页面

- 显示关键数据摘要：
  - 今日/本周/本月订单数
  - 总销售额
  - 累计佣金收入
  - 待提现佣金
  - 活跃代付链接数量
- 快捷操作按钮：
  - 创建新代付链接
  - 查看订单列表
  - 申请提现
- 系统通知和公告区域

##### 3.10.4.2 产品管理

- 商品列表页，包含：
  - 商品图片、名称
  - 原价
  - 当前设置的折扣价（如有）
  - 操作按钮（设置折扣、生成链接）
- 支持按分类、价格区间筛选商品
- 支持搜索商品名称
- 批量操作功能：
  - 批量设置相同折扣比例
  - 批量生成代付链接
- 显示每个商品的历史销售数据和佣金收益

##### 3.10.4.3 订单数据管理

- 订单列表页，包含：
  - 订单编号
  - 订单日期时间
  - 商品信息
  - 原价和折扣价
  - 数量
  - 佣金金额
  - 支付状态
  - 代付人信息（如有）
- 高级筛选功能：
  - 日期范围
  - 价格区间
  - 佣金金额
  - 特定商品
- 订单详情查看，包含完整交易记录
- 数据导出功能（CSV/Excel格式）
- 订单统计报表（按日/周/月/商品类别等维度）

##### 3.10.4.4 佣金管理与提款

- 佣金概览：
  - 累计佣金总额
  - 已提现佣金
  - 待结算佣金（未满足提现条件）
  - 可提现佣金
- 佣金明细列表：
  - 订单信息（订单号、日期）
  - 商品信息
  - 销售金额
  - 佣金金额
  - 结算状态（待结算、可提现、已提现）
- 提款申请流程：
  - 选择提款金额（系统显示最大可提现金额）
  - 确认提款账户信息（USDT地址）
  - 提交提款申请
- 提款记录查询：
  - 申请日期
  - 提款金额
  - 处理状态（审核中、已通过、已拒绝、已打款）
  - 到账时间

##### 3.10.4.5 个人账户设置

- 个人资料管理：
  - 基本信息（姓名、联系方式）
  - 头像上传
  - 默认显示名称设置（用于代付页面显示）
- 支付信息管理：
  - 添加/编辑USDT地址
- 默认设置：
  - 默认折扣比例
  - 默认邀请文案模板

### 3.11 区域代理系统

#### 3.11.1 经销商管理

- 经销商招募：
  - 创建经销商账户
  - 设置经销商基本信息
  - 设置经销商佣金比例（不能超过区域代理自身比例）
- 经销商列表：
  - 查看自己名下所有经销商
  - 经销商状态管理（启用/禁用）
  - 经销商业绩统计
  - 经销商排名

#### 3.11.2 订单管理

- 查看所有区域内订单
- 筛选功能：
  - 按经销商筛选
  - 按时间段筛选
  - 按金额范围筛选
- 订单详情查看：
  - 支付信息
  - 佣金分配明细

#### 3.11.3 佣金管理

- 佣金设置：
  - 设置区域内经销商的佣金比例
  - 设置特殊商品的佣金比例
- 佣金统计：
  - 区域内佣金总览
  - 经销商佣金明细
  - 佣金趋势分析
  - 佣金报表导出

#### 3.11.4 财务管理

- 提现申请审核：
  - 审核区域内经销商的提现申请
  - 提现记录查看
  - 提现状态管理
- 管理财务：
  - 查看区域内经销商的USDT地址
  - 管理自身USDT地址

#### 3.11.5 数据分析

- 销售数据看板：
  - 区域销售趋势
  - 热销商品分析
  - 经销商业绩对比
- 客户数据分析：
  - 客户地域分布
  - 客户购买频次分析
  - 客户平均消费金额

### 3.12 管理员系统

#### 3.12.1 系统管理

- 系统参数配置（平台名称、LOGO）
- 数据库备份
- PayPal的API密钥管理
- 系统日志查看

#### 3.12.2 商户管理

- 商户添加：
  - 基本信息设置（名称、地址、联系方式、营业执照等）
  - 营业时间设置
- 商户列表：
  - 查看所有商户
  - 高级筛选、搜索功能
  - 状态管理（审核、启用、禁用、删除）
- 商户装修：
  - 店铺页面设置
  - 主题颜色设置
  - Banner图设置

#### 3.12.3 产品管理

- 产品添加：
  - 基本信息设置
  - 多图片上传与管理
  - 价格设置（原始价格、最低折扣限制）
  - 分类标签设置
- 产品列表：
  - 全平台产品查看
  - 批量管理（导入/导出）
  - 上架/下架控制
  - 价格调整
- 分类管理：
  - 创建多级分类
  - 设置分类顺序
  - 分类图标设置
  - 分类关联与推荐
- 商品评价管理：
  - 添加虚拟评价
  - 评价审核
  - 评价置顶/删除

#### 3.12.4 订单管理

- 全平台订单实时查看
- 高级订单筛选（时间、金额、商户、状态等）
- 订单详情查看与编辑
- 订单状态流程管理
- 订单数据导出

#### 3.12.5 用户管理

- 区域代理管理：
  - 创建区域代理账户
  - 权限设置
  - 业绩统计与考核
  - 佣金比例设置（区域代理层面）
- 分销商管理：
  - 分销商账户管理
  - 分销商层级设置
  - 全局佣金比例设置

#### 3.12.6 财务管理

- 提现管理：
  - 提现申请审核
  - 提现记录查询
  - 提现状态管理
- 佣金设置：
  - 全局佣金比例设置
  - 特殊商品佣金比例设置
  - 佣金结算周期设置
- 交易记录：
  - 全平台交易明细
  - 交易统计报表
  - 异常交易标记与处理

#### 3.12.7 内容管理

- 平台公告发布：
  - 创建/编辑公告
  - 设置公告显示范围（全平台/区域代理/分销商）
  - 公告有效期设置
- 帮助中心内容管理：
  - FAQ管理
  - 使用指南管理
- 营销内容管理：
  - 首页Banner管理
  - 活动专区设置

## 4. 用户体验流程

### 4.1 普通用户体验流程

#### 4.1.1 浏览和尝试下单

1. 访问COKFOOD首页，无需登录
2. 浏览餐厅列表，点击感兴趣的餐厅
3. 查看菜单，选择商品
4. 点击"立即购买"，进入订单填写页面
5. 填写配送地址和其他必要信息
6. 点击"提交订单"按钮
7. 系统显示错误："很抱歉，您的地址不在我们的配送范围内"
8. 用户可点击"修改地址"，返回地址填写页面

#### 4.1.2 尝试使用邀请代付功能

1. 用户在商品详情页点击"邀请代付"按钮
2. 系统要求用户填写配送地址
3. 用户填写地址后点击继续
4. 系统验证地址，显示错误："很抱歉，您的地址不在我们的配送范围内，无法生成代付链接"
5. 提供"修改地址"选项，用户可返回重新填写
6. 用户无法成功生成代付链接

### 4.2 分销商体验流程

#### 4.2.1 登录和设置折扣

1. 分销商使用管理员提供的账户信息登录系统
2. 分销商浏览餐厅和菜单，选择想要推广的商品
3. 商品详情页显示"设置折扣"选项，分销商点击该选项
4. 弹出折扣设置面板，显示原价
5. 分销商设置折扣价格（通过输入框或滑动条）
6. 输入显示名称（将显示为"您正在帮助[名称]支付外卖"）
7. 系统实时计算预计佣金
8. 分销商点击"生成代付链接"按钮

#### 4.2.2 生成和分享代付链接

1. 系统生成唯一代付链接
2. 显示链接预览，展示受邀方将看到的页面
3. 分销商选择"复制链接"，系统提示"链接已复制到剪贴板"
4. 分销商可选择其他分享方式（如生成二维码）
5. 分销商通过社交媒体或即时通讯工具将链接发送给目标用户

#### 4.2.3 管理后台操作

1. 分销商点击顶部"后台管理"进入分销商控制面板
2. 查看今日订单数、销售额和佣金收入概览
3. 进入"代付链接"页面，查看所有已生成的链接
4. 筛选最近创建的链接，查看使用情况
5. 进入"订单管理"页面，查看通过代付完成的订单
6. 查看佣金明细，确认可提现金额
7. 在"提现管理"页面申请提现到USDT地址
8. 系统显示提现申请已提交，等待审核

### 4.3 受邀付款方体验流程

#### 4.3.1 访问代付链接

1. 用户收到分销商分享的代付链接
2. 点击链接，打开COKFOOD代付专属页面
3. 页面顶部显示："您正在帮助[名称]支付外卖"
4. 页面清晰展示商品的图片、描述和价格信息
5. 价格显示为分销商设置的折扣价格

#### 4.3.2 完成支付

1. 用户可调整商品数量（默认为1）
2. 页面不要求填写配送地址
3. 用户点击"PayPal支付"按钮
4. 系统跳转到PayPal支付页面
5. 用户在PayPal页面完成支付
6. 支付成功后，跳转回COKFOOD的支付成功页面
7. 显示"感谢您的支付！您已成功帮助[名称]支付了外卖"

### 4.4 区域代理体验流程

#### 4.4.1 经销商管理

1. 区域代理登录系统
2. 进入"经销商管理"页面
3. 创建新经销商账户，设置基本信息和佣金比例
4. 查看经销商列表和业绩统计
5. 根据业绩数据调整经销商状态和佣金比例

#### 4.4.2 订单和财务管理

1. 查看区域内所有订单
2. 审核经销商的提现申请
3. 查看区域内佣金分配情况
4. 导出佣金报表进行分析
5. 管理自身USDT提现地址

### 4.5 管理员体验流程

#### 4.5.1 系统和内容管理

1. 管理员登录系统
2. 配置系统参数和API密钥
3. 添加和管理商户信息
4. 添加和管理商品信息
5. 发布平台公告和营销内容

#### 4.5.2 用户和财务管理

1. 创建和管理区域代理账户
2. 设置全局佣金比例
3. 审核提现申请
4. 查看平台交易记录和财务报表
5. 处理异常交易和用户反馈

## 5. UI/UX 设计规范

### 5.1 设计语言

#### 5.1.1 色彩系统

- 主色调：#FF4757（鲜红色）
- 辅助色：#2F3542（深灰色）
- 强调色：#FFA502（橙黄色）
- 背景色：#F8F9FA（浅灰色）
- 文本色：
  - 主要文本：#2F3542
  - 次要文本：#6C757D
  - 提示文本：#ADB5BD
- 功能色：
  - 成功：#28A745
  - 警告：#FFC107
  - 危险：#DC3545
  - 信息：#17A2B8

#### 5.1.2 排版

- 字体系列：'DM Sans', sans-serif
- 字体大小：
  - 超大标题：24px-32px
  - 大标题：20px-24px
  - 中标题：18px
  - 小标题：16px
  - 正文：14px
  - 小文本：12px
- 字重：
  - 常规：400
  - 中等：500
  - 粗体：600
  - 特粗：700

#### 5.1.3 图标系统

- 使用Font Awesome图标库
- 主要操作图标尺寸：24px
- 辅助图标尺寸：16px-20px
- 图标颜色与文本保持一致或使用主题色

### 5.2 组件设计

#### 5.2.1 卡片

- 圆角：16px-24px（大圆角设计）
- 阴影：轻微阴影效果，悬停时加深
- 内边距：16px-24px
- 背景色：白色
- 边框：无边框或极细边框

#### 5.2.2 按钮

- 主按钮：
  - 背景色：主色调
  - 文本色：白色
  - 圆角：完全圆角（pill style）
  - 内边距：水平24px，垂直12px
  - 悬停效果：颜色轻微变暗，波纹动画
- 次要按钮：
  - 背景色：浅灰色
  - 文本色：主色调或深灰色
  - 圆角：与主按钮一致
  - 悬停效果：背景色变深

#### 5.2.3 输入框

- 圆角：12px-16px
- 内边距：12px-16px
- 边框：轻微边框，聚焦时变为主题色
- 状态指示：聚焦、错误、成功状态有明确视觉区分

#### 5.2.4 模态框

- 圆角：24px
- 阴影：明显阴影效果
- 内边距：24px
- 动画：淡入淡出并伴随轻微上移效果

### 5.3 交互设计

#### 5.3.1 动画效果

- 页面过渡：淡入淡出
- 元素加载：轻微上移并淡入
- 按钮点击：波纹效果
- 卡片悬停：轻微上移并加深阴影
- 图片悬停：轻微放大

#### 5.3.2 反馈机制

- 操作成功：轻微弹出提示，绿色图标
- 操作失败：轻微弹出提示，红色图标
- 加载状态：简洁加载动画
- 点击反馈：视觉变化和微小动画

## 6. 技术要求

### 6.1 系统架构

- 前端技术栈：React/Vue.js，响应式设计
- 后端技术栈：Node.js/PHP，RESTful API
- 数据库：MySQL/MongoDB
- 支付集成：PayPal API
- 服务器要求：支持HTTPS，高可用性配置

### 6.2 安全要求

- 数据传输加密（HTTPS）
- 支付信息安全处理
- 防SQL注入
- 防XSS攻击
- 用户认证与授权
- 敏感数据加密存储

### 6.3 性能要求

- 页面加载时间≤3秒
- 支付处理响应时间≤5秒
- 系统可同时处理≥1000个并发用户
- 数据备份机制

### 6.4 兼容性要求

- 支持主流浏览器（Chrome, Safari, Firefox, Edge）
- 移动设备自适应（iOS, Android）
- 不同屏幕尺寸响应式设计

## 7. 项目实施计划

### 7.1 开发阶段

- 需求确认与分析：1周
- 系统设计：2周
- 前端开发：4周
- 后端开发：4周
- 集成测试：2周
- 用户验收测试：1周
- 部署上线：1周

### 7.2 上线后支持

- 系统监控与维护
- 性能优化
- 功能迭代
- 用户反馈收集与处理

## 8. 附录

### 8.1 术语表

- **分销商**：由管理员指定，可设置折扣价格并生成代付链接的特殊用户
- **区域代理**：管理多个分销商的中间层级用户
- **代付链接**：分销商生成的包含商品和价格信息的唯一链接，用于邀请他人支付
- **佣金**：分销商通过代付链接完成交易后获得的收益

### 8.2 页面清单

1. 首页 (shouye.html)
2. 商家分类页面 (Categories.html)
3. 商家详情页面 (shangjiaxiangqing.html)
4. 商品详情页面 (shangpinxiangqing.html)
5. 订单填写页面 (dingdan.html)
6. 不在配送区域错误页面 (404.html)
7. 分销商商品详情页面 (jingxiaoshangyemian.html)
8. 代付页面 (daifu.html)
9. 分销商后台管理页面
10. 区域代理后台管理页面
11. 管理员后台管理页面

### 8.3 特别说明

本产品的核心业务逻辑是通过分销商生成代付链接，邀请他人付款。普通用户尝试直接下单时，系统始终返回"不在配送区域"错误，引导用户使用代付功能。只有通过分销商生成的代付链接进入系统的用户才能完成支付流程，支付完成后系统会自动记录订单并计算分销商佣金。

分销商获取佣金的方式是设置折扣价格，原价与折扣价之间的差价部分按一定比例分成。佣金比例由管理员和区域代理设定，分销商可以在系统设定的范围内自由设置折扣价格。

整个系统设计以移动端为主，所有页面都采用响应式设计，确保在各种移动设备上都能提供良好的用户体验。

## 9. 技术栈

### 9.1 前端核心

- **Vue 3**: 采用 Vue.js 3 作为前端框架，使用组合式API (Composition API)
- **Vue Router**: Vue.js官方路由管理器，版本4.2.5
- **Pinia**: Vue 3的官方状态管理库，版本2.1.7
- **TypeScript**: 提供类型系统和最新的ECMAScript特性
- **Vite**: 现代化的前端构建工具，提供极速的开发体验

### 9.2 UI组件与样式

- **Vant 4**: 移动端UI组件库，提供丰富的移动端组件和样式
- **Swiper**: 现代化的移动触摸滑块库，用于轮播图实现
- **Sass**: CSS预处理器，增强样式管理能力

### 9.3 工具库

- **Axios**: 基于Promise的HTTP客户端，用于浏览器和Node.js环境
- **Lodash**: 实用的JavaScript工具库，提供模块化和高性能的方法

### 9.4 开发工具

- **ESLint**: JavaScript和TypeScript代码质量检查工具
- **Prettier**: 代码格式化工具
- **Vitest**: Vue官方测试框架
- **Playwright**: 端到端测试工具

## 10. 项目结构

项目采用模块化的目录结构，便于代码管理和维护：

```
src/
├── api/            # API接口请求模块，按业务模块组织
├── assets/         # 静态资源文件
│   ├── images/     # 图片资源
│   └── styles/     # 样式文件，包括全局样式和变量
├── components/     # 通用组件，可在多个页面中复用
├── hooks/          # 自定义组合式函数（Composables）
├── mock/           # 模拟数据，用于开发阶段
├── router/         # 路由配置
├── stores/         # Pinia状态管理，按功能模块组织
├── types/          # TypeScript类型定义
├── utils/          # 工具函数，如格式化、校验等
├── views/          # 页面组件，按业务功能组织
├── App.vue         # 应用根组件
└── main.ts         # 应用入口文件
```

### 10.1 目录说明

- **api/**: 存放与后端API交互的模块，按业务领域划分不同文件
- **assets/**: 存放静态资源
  - **images/**: 项目中使用的图片资源
  - **styles/**: 全局样式定义、样式变量、mixins等
- **components/**: 可复用的UI组件，遵循单一职责原则
- **hooks/**: 自定义Vue组合式函数，提升代码复用性
- **mock/**: 模拟数据，便于前后端分离开发
- **router/**: 路由配置，包括路由守卫、路由映射等
- **stores/**: Pinia状态管理，按功能模块拆分store
- **types/**: TypeScript类型定义，确保类型安全
- **utils/**: 通用工具函数和辅助方法
- **views/**: 具体页面组件，对应路由配置中的各个页面

## 11. 样式架构

项目采用SCSS预处理器管理样式，通过模块化和变量系统提升样式维护性和一致性。

### 11.1 样式文件组织

```
src/assets/styles/
├── variables.scss  # 全局变量（颜色、字体、间距等）
├── mixins.scss     # 混合器和函数
├── reset.scss      # 重置浏览器默认样式
└── main.scss       # 主样式入口文件
```

### 11.2 样式策略

- **变量系统**: 使用SCSS变量统一管理颜色、字体、间距等，确保UI设计一致性
- **混合器(Mixins)**: 封装常用样式模式，如弹性布局、媒体查询等，提高代码复用性
- **命名规范**: 采用BEM (Block Element Modifier) 命名方法论，确保样式的可维护性和可扩展性
- **响应式设计**: 使用媒体查询混合器实现移动优先的响应式设计
- **CSS架构**: 基于ITCSS (Inverted Triangle CSS) 架构组织样式，从通用到具体，降低特异性冲突

### 11.3 样式引用

对于全局样式，在main.ts中引入主样式文件:

```typescript
import '@/assets/styles/main.scss'
```

对于组件级样式，在各Vue组件中使用scoped样式块，避免样式污染:

```vue
<style lang="scss" scoped>
/* 组件样式 */
</style>
```

全局公用UI组件采用单独的样式文件，通过Vue插件形式注册。

### 11.4 颜色系统

COKFOOD采用系统化的颜色管理方案，确保整个应用的视觉一致性：

#### 主题色系

- **主色调 ($primary)**: #FF4757 - 鲜红色，用于主按钮、重要操作元素、品牌标识
- **辅助色 ($secondary)**: #2F3542 - 深灰色，用于次要元素、标题、边框
- **强调色 ($accent)**: #FFA502 - 橙黄色，用于需要突出显示的元素、促销信息
- **背景色 ($background)**: #F8F9FA - 浅灰色，用于页面背景、卡片背景

#### 功能色系

- **成功 ($success)**: #28A745 - 用于成功状态、完成操作
- **警告 ($warning)**: #FFC107 - 用于警告信息、需要注意的操作
- **危险 ($danger)**: #DC3545 - 用于错误状态、删除操作
- **信息 ($info)**: #17A2B8 - 用于提示信息、帮助文本

#### 中性色系

项目使用一套从浅到深的灰度色阶（$gray-100 到 $gray-900），用于文本、边框、分割线等元素，确保界面层次分明。

#### 透明度系统

- **轻度透明 ($opacity-light)**: 0.1 - 用于微妙效果、背景悬停状态
- **中度透明 ($opacity-medium)**: 0.5 - 用于遮罩层、禁用状态
- **高度透明 ($opacity-high)**: 0.8 - 用于模态框背景、强调层

### 11.5 排版系统

COKFOOD采用精心设计的排版系统，确保在各种设备上的可读性和视觉层次结构：

#### 字体系列

- **基础字体**: 'DM Sans'，搭配系统备用字体。选择DM Sans作为主要字体是因为其清晰、现代、友好的风格特别适合食品类应用。

#### 字体大小

明确定义的字体大小层级，适应不同场景：

- **$font-size-xxs (12px)**: 用于辅助信息、脚注、标签
- **$font-size-xs (14px)**: 用于小文本、二级内容、注释
- **$font-size-sm (16px)**: 用于正文文本、菜单项、按钮
- **$font-size-md (18px)**: 用于小标题、强调内容
- **$font-size-lg (20px)**: 用于中标题、卡片标题
- **$font-size-xl (24px)**: 用于大标题、页面标题
- **$font-size-xxl (28px)**: 用于超大标题、页面主标题、促销文本

#### 字重使用规范

- **常规字重 (400)**: 用于大部分正文内容
- **中等字重 (500)**: 用于次要标题和强调内容
- **半粗体 (600)**: 用于按钮和重要元素
- **粗体 (700)**: 用于主标题和特别强调的内容

#### 行高规范

- **紧凑行高 (1.25)**: 用于标题、单行文本
- **基础行高 (1.5)**: 用于正文段落、一般内容
- **宽松行高 (1.75)**: 用于长文本、阅读区域

#### 字间距

- **紧凑字距 (-0.025em)**: 用于大号标题
- **正常字距 (0)**: 用于大多数文本
- **宽松字距 (0.025em)**: 用于小号文本、强调内容

#### 排版组合示例

```scss
// 页面标题
h1 {
  font-size: $font-size-xl;
  font-weight: $font-weight-bold;
  line-height: $line-height-tight;
  letter-spacing: $letter-spacing-tight;
}

// 正文文本
p {
  font-size: $font-size-sm;
  font-weight: $font-weight-regular;
  line-height: $line-height-base;
  letter-spacing: $letter-spacing-normal;
}

// 强调文本
.emphasis {
  font-size: $font-size-md;
  font-weight: $font-weight-medium;
  line-height: $line-height-base;
  letter-spacing: $letter-spacing-wide;
}
```

### 11.6 间距和布局系统

COKFOOD采用系统化的间距和布局规范，确保界面元素之间的关系清晰一致：

#### 间距系统

基于4px为基础单位($spacing-unit)的间距系统，创建有节奏的视觉层次：

- **$spacing-xxs (4px)**: 用于极小元素间距，如图标与文本之间
- **$spacing-xs (8px)**: 用于紧凑元素间距，如按钮内部的内边距
- **$spacing-sm (12px)**: 用于常规元素内部间距，如表单元素
- **$spacing-md (16px)**: 用于组件内部元素间距，卡片内边距
- **$spacing-lg (24px)**: 用于相关元素组之间的间距
- **$spacing-xl (32px)**: 用于主要区块之间的间距
- **$spacing-xxl (48px)**: 用于页面主要区域之间的分隔

使用基于相同单位的间距系统可以创造出视觉上协调一致的节奏感，提升用户体验。

#### 圆角规范

不同程度的圆角适用于不同尺寸和重要性的元素：

- **$border-radius-sm (4px)**: 用于小型元素，如标签、徽章
- **$border-radius-md (8px)**: 用于中型元素，如表单输入框、卡片
- **$border-radius-lg (16px)**: 用于大型元素，如模态框、特色卡片
- **$border-radius-xl (24px)**: 用于强调元素，如促销区块
- **$border-radius-pill (9999px)**: 用于胶囊形状，如按钮、标签

#### 阴影系统

阴影用于表达元素的层级和高度关系：

- **$shadow-sm**: 用于轻微突出元素，如卡片、菜单
- **$shadow-md**: 用于中等突出元素，如下拉菜单、悬浮卡片
- **$shadow-lg**: 用于高度突出元素，如模态框、弹出窗口
- **$shadow-xl**: 用于特别强调元素，如促销区块、重要通知

#### 响应式断点

移动优先的断点设计：

- **$breakpoint-xs (375px)**: 小型手机设备
- **$breakpoint-sm (576px)**: 大型手机设备
- **$breakpoint-md (768px)**: 平板设备
- **$breakpoint-lg (992px)**: 小型桌面显示器
- **$breakpoint-xl (1200px)**: 大型桌面显示器

#### Z轴层级管理

清晰定义的z-index层级，避免层叠冲突：

- **$z-index-dropdown (1000)**: 下拉菜单
- **$z-index-sticky (1020)**: 粘性元素（如粘性头部）
- **$z-index-fixed (1030)**: 固定元素（如固定导航栏）
- **$z-index-modal-backdrop (1040)**: 模态框背景
- **$z-index-modal (1050)**: 模态框
- **$z-index-popover (1060)**: 弹出框
- **$z-index-tooltip (1070)**: 工具提示

#### 布局组合示例

```scss
// 卡片组件
.card {
  padding: $spacing-md;
  border-radius: $border-radius-md;
  box-shadow: $shadow-sm;

  &__header {
    margin-bottom: $spacing-sm;
  }

  &__content {
    margin-bottom: $spacing-md;
  }

  &--featured {
    border-radius: $border-radius-lg;
    box-shadow: $shadow-md;
    padding: $spacing-lg;
  }
}

// 响应式容器
.container {
  padding: 0 $spacing-md;

  @media (min-width: $breakpoint-md) {
    padding: 0 $spacing-lg;
  }

  @media (min-width: $breakpoint-lg) {
    max-width: 960px;
    margin: 0 auto;
  }
}
```

### 11.7 混合器(Mixins)系统

COKFOOD项目中的SCSS混合器提供了可复用的样式模块，减少代码重复并确保一致性：

#### 布局混合器

- **flex**: 快速创建弹性布局，支持自定义方向、对齐和换行

  ```scss
  @include flex(column, center, flex-start);
  ```

- **absolute/fixed**: 快速设置绝对或固定定位
  ```scss
  @include absolute(0, 0, auto, auto); // 固定在右上角
  @include fixed(auto, auto, 0, 0); // 固定在左下角
  ```

#### 文本处理

- **text-truncate**: 单行文本截断，超出部分显示省略号

  ```scss
  .title {
    @include text-truncate;
  }
  ```

- **text-truncate-multiline**: 多行文本截断控制
  ```scss
  .description {
    @include text-truncate-multiline(3); // 显示3行，超出省略
  }
  ```

#### 响应式设计

- **screen-xs/sm/md/lg/xl**: 针对不同屏幕尺寸的媒体查询

  ```scss
  .container {
    padding: $spacing-md;

    @include screen-md {
      padding: $spacing-lg;
    }

    @include screen-lg {
      max-width: 960px;
      margin: 0 auto;
    }
  }
  ```

#### 组件样式

- **card**: 应用卡片样式，包含背景色、圆角和阴影

  ```scss
  .info-card {
    @include card;
    margin-bottom: $spacing-md;
  }
  ```

- **button-base**: 按钮基础样式

  ```scss
  .btn-primary {
    @include button-base;
    background-color: $primary;
    color: $white;

    &:hover {
      background-color: darken($primary, 10%);
    }
  }
  ```

#### 状态控制

- **disabled**: 应用禁用状态样式

  ```scss
  .btn-submit {
    // 按钮样式

    &[disabled] {
      @include disabled;
    }
  }
  ```

- **transition**: 自定义过渡效果

  ```scss
  .hover-card {
    @include transition(transform, $transition-base);

    &:hover {
      transform: translateY(-4px);
    }
  }
  ```

#### 使用场景示例

使用混合器组合创建组件：

```scss
.feature-card {
  @include card;
  @include flex(column, flex-start, flex-start);

  &__title {
    @include text-truncate;
    font-size: $font-size-lg;
    margin-bottom: $spacing-sm;
  }

  &__description {
    @include text-truncate-multiline(2);
    color: $text-secondary;
    margin-bottom: $spacing-md;
  }

  &__action {
    @include button-base;
    background-color: $primary;
    color: $white;
    align-self: flex-start;

    &--disabled {
      @include disabled;
    }
  }

  @include screen-md {
    flex-direction: row;
    align-items: center;
  }
}
```

这些混合器大大简化了样式开发工作，使代码更加简洁、一致和可维护。通过组合使用这些工具，可以快速构建符合设计规范的界面组件。

### 11.8 重置样式系统

COKFOOD项目使用专门为移动端优化的重置样式，消除浏览器默认样式差异并提供一致的基础：

#### 基础重置

- 移除所有元素的默认内外边距，统一盒模型为`border-box`
- 设置HTML和Body的高度为100%，让应用可以充满整个视口
- 消除移动设备上的点击高亮效果，提供更原生的应用体验
- 保持文本可读性，设置基础行高和字体族

#### 移动端优化

- **触摸体验优化**：移除触摸时的高亮效果，改善移动端交互体验
- **表单元素规范化**：移除iOS上的默认表单样式，提供一致的表单外观
- **方向变化稳定**：阻止设备方向变化时的字体大小自动调整
- **垂直溢出处理**：允许垂直滚动，但阻止水平溢出导致的页面抖动

#### 无障碍优化

- **键盘用户焦点样式**：为键盘用户提供清晰的焦点指示，提高可访问性
- **保留`:focus-visible`**：仅对键盘用户显示焦点轮廓，鼠标用户不显示
- **自定义焦点轮廓**：使用主题色作为焦点轮廓颜色，提供品牌一致性

#### 特殊元素处理

- 图片和SVG统一处理，设置垂直对齐和最大宽度
- 统一表单元素的外观，继承字体样式
- 定制标题和段落的间距，提供良好的阅读节奏
- 优化Vue应用容器(#app)高度，确保全屏应用正常显示

通过这套移动优先的重置样式，COKFOOD能够在不同设备和浏览器上提供一致的基础体验，同时为无障碍使用提供支持。完善的重置样式是构建高质量移动应用的基础，它为后续的组件开发提供了稳定的起点。

## 12. 路由系统

COKFOOD项目使用Vue Router进行路由管理，采用懒加载方式优化性能，并为每个页面配置元数据：

### 12.1 路由结构

项目的路由结构映射了用户在应用中的主要流程：

```
/                      # 首页 - 展示餐厅列表和促销信息
├── /restaurant/:id    # 餐厅详情页 - 展示特定餐厅的菜单
├── /product/:id       # 商品详情页 - 展示特定食品的详细信息
├── /checkout          # 结账页面 - 填写订单信息
├── /payment/:id       # 支付页面 - 处理付款流程
├── /not-available     # 不在配送范围页面 - 显示配送范围错误
├── /login             # 登录页面 - 用户认证
└── /*                 # 404页面 - 处理未找到的路由
```

### 12.2 路由特性

#### 代码分割与懒加载

所有页面组件均采用动态导入方式，实现按需加载：

```typescript
component: () => import('@/views/home/HomePage.vue')
```

这种方式可以有效减小初始加载体积，提高首屏加载速度。

#### 元数据管理

每个路由都包含元信息，用于配置页面特性：

```typescript
meta: {
  title: 'COKFOOD - Food Delivery',  // 页面标题
  keepAlive: true                    // 是否缓存页面
}
```

#### 页面缓存控制

首页等高频访问页面通过`keepAlive`属性启用缓存，减少重复渲染。

#### 滚动行为

实现了智能滚动行为管理：

- 返回前一页面时，恢复之前的滚动位置
- 前往新页面时，自动滚动到顶部

```typescript
scrollBehavior(to, from, savedPosition) {
  if (savedPosition) {
    return savedPosition
  } else {
    return { top: 0 }
  }
}
```

#### 全局导航守卫

使用`beforeEach`钩子动态设置页面标题：

```typescript
router.beforeEach((to, from, next) => {
  document.title = (to.meta.title as string) || 'COKFOOD'
  next()
})
```

### 12.3 页面组织结构

路由对应的视图组件结构如下：

```
src/views/
├── home/             # 首页相关组件
├── restaurant/       # 餐厅详情相关组件
├── product/          # 商品详情相关组件
├── order/            # 订单和结账相关组件
├── payment/          # 支付流程相关组件
├── auth/             # 认证相关组件
└── error/            # 错误页面组件
```

每个页面组件不仅处理路由参数，还负责与Pinia状态管理协同，获取和更新数据。例如，商品详情页通过路由参数`id`获取商品信息：

```typescript
// ProductPage.vue 示例
const route = useRoute()
const productId = route.params.id as string
const productStore = useProductStore()

onMounted(() => {
  productStore.fetchProductById(productId)
})
```

通过这种组织方式，COKFOOD应用实现了清晰的导航结构和高效的页面加载模式，为移动端用户提供流畅的浏览体验。

## 13. 状态管理

COKFOOD项目使用Pinia作为状态管理解决方案，采用组合式API风格组织状态逻辑。基于功能模块划分，实现了高度解耦的状态管理架构。

### 13.1 状态管理架构

项目的状态管理遵循以下原则：

- **模块化设计**：按业务领域拆分Store，每个Store负责单一职责
- **组合式API风格**：使用`defineStore`与`setup`风格API，提高代码可读性
- **TypeScript支持**：全面类型定义，提供完整的类型推断和安全性
- **扁平化状态**：避免过度嵌套状态，减少复杂性
- **持久化支持**：关键用户数据持久化到localStorage

### 13.2 主要Store模块

#### 13.2.1 购物车模块

`useCartStore`负责管理用户购物车，提供以下功能：

- **状态管理**：
  - 购物车商品列表
  - 数量、金额等计算属性
- **主要操作**：
  - 添加商品到购物车
  - 更新商品数量
  - 移除商品
  - 清空购物车
- **业务规则**：
  - 同一商品自动合并数量
  - 支持商品选项（如配料、规格）管理
  - 实时计算总价和折扣

```typescript
// 使用示例
const cartStore = useCartStore()
cartStore.addItem({
  id: '123',
  name: '香辣鸡腿堡',
  price: 25.8,
  image: '/images/burger.jpg',
  restaurantId: 'kfc-001',
  restaurantName: 'KFC',
})
```

#### 13.2.2 用户模块

`useUserStore`处理用户认证和个人信息，包括：

- **状态管理**：
  - 当前用户信息
  - 认证令牌
  - 登录状态
- **主要操作**：
  - 用户登录/登出
  - 令牌管理
  - 权限检查
- **特性**：
  - 令牌持久化到localStorage
  - 自动校验令牌有效性
  - 基于角色的权限管理（用户/分销商/代理/管理员）

```typescript
// 使用示例
const userStore = useUserStore()

// 检查用户权限
if (userStore.isDistributor) {
  // 显示分销商特有功能
}

// 登出操作
function handleLogout() {
  userStore.logout()
  router.push('/login')
}
```

### 13.3 Store组织结构

项目的状态管理文件组织如下：

```
src/stores/
├── index.ts                # Pinia实例和插件配置
├── modules/                # 按功能分组的Store模块
│   ├── cart.ts             # 购物车状态管理
│   ├── user.ts             # 用户认证与信息管理
│   ├── restaurant.ts       # 餐厅数据管理
│   ├── product.ts          # 商品数据管理
│   ├── order.ts            # 订单流程管理
│   └── payment.ts          # 支付状态管理
└── types/                  # 类型定义文件
    ├── cart.ts             # 购物车相关类型
    ├── user.ts             # 用户相关类型
    └── ...
```

### 13.4 Store与组件集成

在组件中使用Store的最佳实践：

```vue
<script setup lang="ts">
import { computed } from 'vue'
import { useCartStore } from '@/stores/modules/cart'
import { useUserStore } from '@/stores/modules/user'

// 初始化Store
const cartStore = useCartStore()
const userStore = useUserStore()

// 派生状态
const totalPrice = computed(() => cartStore.totalAmount)
const canCheckout = computed(() => cartStore.totalItems > 0 && userStore.isLoggedIn)

// 操作方法
function handleAddToCart(product) {
  cartStore.addItem({
    id: product.id,
    name: product.name,
    price: product.price,
    image: product.image,
    restaurantId: product.restaurantId,
    restaurantName: product.restaurantName,
  })
}
</script>
```

### 13.5 状态持久化

关键用户数据通过localStorage持久化，确保页面刷新后保持状态：

```typescript
// user.ts Store示例
export const useUserStore = defineStore('user', () => {
  // 状态
  const token = ref<string | null>(localStorage.getItem('token'))

  // 操作
  function setToken(newToken: string) {
    token.value = newToken
    localStorage.setItem('token', newToken)
  }

  function logout() {
    token.value = null
    localStorage.removeItem('token')
  }

  // 启动时检查认证状态
  function checkAuth() {
    const savedToken = localStorage.getItem('token')
    if (savedToken) {
      token.value = savedToken
      // 验证token有效性...
    }
  }

  return { token, setToken, logout, checkAuth }
})
```

通过这种模块化、类型安全的状态管理架构，COKFOOD应用实现了高度可维护的状态逻辑，为复杂的交互流程提供了可靠的数据基础。

## 14. API请求

COKFOOD项目使用Axios进行API请求，通过模块化的方式组织API调用，并实现了统一的错误处理和拦截器机制。

### 14.1 请求工具设计

项目的API请求工具基于以下原则设计：

- **环境适配**：根据不同环境（开发/生产）自动切换API基础路径
- **身份验证**：自动在请求头中添加认证令牌
- **响应格式统一**：统一处理API响应数据结构
- **错误处理集中化**：集中处理HTTP错误和网络异常
- **类型安全**：使用TypeScript泛型保证请求和响应的类型安全

### 14.2 请求拦截器

请求拦截器主要负责在发送请求前进行处理：

```typescript
service.interceptors.request.use(
  (config) => {
    // 从localStorage获取token并添加到请求头
    const token = localStorage.getItem('token')
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`
    }
    return config
  },
  (error) => {
    console.error('Request error:', error)
    return Promise.reject(error)
  },
)
```

这种设计确保了所有需要认证的API请求都能自动附带有效的认证信息。

### 14.3 响应拦截器

响应拦截器处理API返回的数据和错误情况：

```typescript
service.interceptors.response.use(
  (response) => {
    // 直接返回响应数据
    return response.data
  },
  (error) => {
    // 处理错误情况
    if (error.response) {
      const { status } = error.response

      // 处理401未授权错误
      if (status === 401) {
        // 清除token并跳转到登录页
        localStorage.removeItem('token')
        window.location.href = '/login'
      }

      // 显示错误信息
      console.error(`Error ${status}: ${error.response.data.message || 'Request failed'}`)
    } else {
      console.error('Network error:', error.message)
    }

    return Promise.reject(error)
  },
)
```

该拦截器实现了几个关键功能：

- 自动提取响应数据，简化API调用
- 统一处理401未授权错误，自动跳转登录页
- 集中处理HTTP错误和网络异常

### 14.4 API模块化组织

API请求按业务领域组织为不同模块：

```
src/api/
├── index.ts          # API模块入口，聚合导出所有API
├── restaurant.ts     # 餐厅相关API
├── product.ts        # 商品相关API
├── order.ts          # 订单相关API
└── user.ts           # 用户认证和信息API
```

每个API模块负责其对应业务领域的数据交互，并包含相关的TypeScript接口定义，确保类型安全。

### 14.5 环境配置

通过Vite环境变量配置不同环境的API基础路径：

- 开发环境 (.env.development)：

  ```
  VITE_API_BASE_URL=/api
  ```

- 生产环境 (.env.production)：
  ```
  VITE_API_BASE_URL=https://api.cokfood.com/api
  ```

这种设计使得应用可以无缝切换不同环境的API端点，同时保持代码一致性。

### 14.6 使用示例

在组件中使用API的典型示例：

```typescript
// 在组件中使用API
import { ref, onMounted } from 'vue'
import { getProductById } from '@/api'

export default {
  setup() {
    const product = ref(null)
    const loading = ref(true)
    const error = ref(null)

    async function fetchProduct(id) {
      try {
        loading.value = true
        product.value = await getProductById(id)
      } catch (err) {
        error.value = err.message || '获取商品信息失败'
      } finally {
        loading.value = false
      }
    }

    onMounted(() => {
      const id = route.params.id
      fetchProduct(id)
    })

    return { product, loading, error }
  },
}
```

通过这种模块化、类型安全的API请求架构，COKFOOD项目实现了高度可维护的后端交互层，为应用提供可靠的数据获取和提交机制。

## 15. UI组件库

COKFOOD项目使用自定义UI组件库，旨在保持界面风格一致性，提高开发效率和代码质量。组件库采用Vue 3 + TypeScript开发，遵循组合式API的最佳实践。

### 15.1 按钮组件

按钮组件是UI系统中最基础的交互元素，提供了多种样式和配置选项：

**组件特性**

- 多种类型：主要、次要、成功、警告、危险、信息、文本
- 多种尺寸：小型、中型、大型
- 状态变体：默认、轮廓、圆角、块级、禁用、加载中
- 图标支持：可在按钮左侧或右侧添加图标
- 完全响应式：在不同屏幕尺寸下自动调整

**使用示例**

```vue
<Button type="primary" size="large">提交订单</Button>
<Button type="danger" outlined>删除</Button>
<Button loading>加载中</Button>
<Button icon="fa-search" iconPosition="left">搜索</Button>
```

**组件API**
| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| type | 'primary'/'secondary'/'success'/'warning'/'danger'/'info'/'text' | 'primary' | 按钮类型 |
| size | 'small'/'medium'/'large' | 'medium' | 按钮尺寸 |
| disabled | boolean | false | 是否禁用 |
| loading | boolean | false | 是否显示加载状态 |
| outlined | boolean | false | 是否使用轮廓样式 |
| rounded | boolean | false | 是否使用圆角样式 |
| block | boolean | false | 是否为块级按钮 |
| icon | string | - | 图标类名 |
| iconPosition | 'left'/'right' | 'left' | 图标位置 |

**事件**
| 事件名称 | 说明 | 参数 |
|---------|------|------|
| click | 点击按钮时触发 | MouseEvent |

### 15.2 UI组件开发指南

为确保UI组件的一致性和可维护性，所有组件应遵循以下原则：

1. **单一职责**：每个组件应专注于解决一个特定问题
2. **可组合性**：组件应支持与其他组件组合使用
3. **可配置性**：通过props提供合理的配置选项
4. **无障碍性**：确保组件符合Web无障碍标准(WCAG)
5. **响应式设计**：组件应在各种屏幕尺寸下正常工作
6. **状态管理**：清晰定义和处理组件各种状态
7. **TypeScript支持**：使用TypeScript接口定义所有props和事件
8. **测试覆盖**：编写单元测试和组件测试

### 15.3 组件示例页面

通过访问 `/examples/button` 路由可以查看按钮组件的所有变体和使用示例。

### 15.4 卡片组件

卡片组件是用于信息分组和展示的容器，为内容提供一致的外观和行为：

**组件特性**

- 多种配置选项：标题、副标题、阴影效果和圆角
- 丰富的插槽：封面、头部、主体和底部
- 悬停效果：支持悬停时的动画和阴影变化
- 灵活的样式定制：可通过props和插槽自定义卡片外观

**使用示例**

```vue
<!-- 基础卡片 -->
<Card title="基础卡片">
  <p>这是一个基础卡片的内容部分</p>
</Card>

<!-- 带封面图的卡片 -->
<Card title="餐品名称" subtitle="美味可口">
  <template #cover>
    <img src="/images/food.jpg" alt="食物图片" />
  </template>
  <p>这道菜品选用优质食材，精心烹制而成...</p>
</Card>

<!-- 可悬停卡片 -->
<Card title="可悬停卡片" hoverable>
  <p>鼠标悬停在此卡片上会有动画效果</p>
</Card>

<!-- 带底部操作区的卡片 -->
<Card title="带操作的卡片">
  <p>这是卡片内容</p>
  <template #footer>
    <div style="display: flex; justify-content: flex-end; gap: 8px;">
      <Button size="small" type="text">取消</Button>
      <Button size="small">确认</Button>
    </div>
  </template>
</Card>
```

**组件API**
| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| title | string | - | 卡片标题 |
| subtitle | string | - | 卡片副标题 |
| shadow | boolean / 'always' / 'hover' / 'never' | true | 阴影效果类型 |
| hoverable | boolean | false | 是否启用悬停效果 |
| round | boolean | false | 是否使用圆角风格 |
| bodyStyle | Record<string, string> | {} | 卡片主体自定义样式 |

**插槽**
| 插槽名称 | 说明 |
|---------|------|
| default | 卡片的主体内容 |
| cover | 卡片的封面区域 |
| header | 自定义卡片头部 |
| footer | 卡片底部区域 |

通过访问 `/examples/card` 路由可以查看卡片组件的所有变体和使用示例。

### 15.5 徽章组件

徽章组件是一个小型的状态指示器，用于显示通知、计数或状态信息：

**组件特性**

- 多种类型：支持主要、成功、警告、危险、信息等类型
- 灵活的内容：可以显示数字、文本或使用点状徽章
- 最大值处理：可以设置最大显示数字，超过时显示"最大值+"
- 可隐藏：提供控制徽章显示/隐藏的简便方式
- 响应式设计：自动适应不同屏幕尺寸

**使用示例**

```vue
<!-- 基础徽章 -->
<CokBadge content="5">
  <div class="item"></div>
</CokBadge>

<!-- 不同类型的徽章 -->
<CokBadge content="10" type="success">
  <div class="item"></div>
</CokBadge>
<CokBadge content="99+" type="warning">
  <div class="item"></div>
</CokBadge>
<CokBadge content="New" type="danger">
  <div class="item"></div>
</CokBadge>

<!-- 点状徽章 -->
<CokBadge isDot type="primary">
  <div class="item"></div>
</CokBadge>

<!-- 设置最大值 -->
<CokBadge :content="100" :max="99">
  <div class="item"></div>
</CokBadge>

<!-- 隐藏徽章 -->
<CokBadge content="5" :hidden="true">
  <div class="item"></div>
</CokBadge>

<!-- 与按钮一起使用 -->
<CokBadge content="3">
  <Button>消息</Button>
</CokBadge>
```

**组件API**
| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| content | string/number | '' | 徽章显示的内容 |
| type | 'primary'/'success'/'warning'/'danger'/'info' | 'primary' | 徽章类型 |
| isDot | boolean | false | 是否显示为点状徽章 |
| hidden | boolean | false | 是否隐藏徽章 |
| max | number | 0 | 最大值，为0时不限制，超过最大值时显示"最大值+" |

通过访问 `/examples/badge` 路由可以查看徽章组件的所有变体和使用示例。

### 15.6 布局组件

COKFOOD应用使用一个灵活的布局系统，以提供一致的用户体验，同时适应不同的屏幕尺寸。核心布局组件AppLayout提供了移动优先的应用架构。

#### 15.6.1 AppLayout组件

**组件特性**

- 移动优先设计：针对移动端用户体验优化的布局结构
- 底部导航栏：提供直观的应用内导航，支持常用路由快速访问
- 页面过渡动画：平滑的页面切换效果，提升用户体验
- 视图缓存管理：支持通过keep-alive缓存指定页面，提高性能
- 响应式适配：自动适应不同屏幕尺寸和设备方向

**使用示例**

```vue
<!-- 在App.vue中使用 -->
<template>
  <AppLayout />
</template>

<script setup lang="ts">
import AppLayout from '@/components/layout/AppLayout.vue'
</script>
```

**组件API**
| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| showFooter | boolean | true | 是否显示底部导航栏 |

**自定义导航**
底部导航栏默认包含首页、搜索、订单和个人中心四个导航项，导航数据在组件内通过`navItems`定义：

```typescript
const navItems = ref<NavItem[]>([
  { name: '首页', route: '/', icon: 'fas fa-home' },
  { name: '搜索', route: '/search', icon: 'fas fa-search' },
  { name: '订单', route: '/orders', icon: 'fas fa-list' },
  { name: '我的', route: '/profile', icon: 'fas fa-user' },
])
```

可以根据项目需求修改导航项的名称、路由和图标。图标使用Font Awesome图标库，确保在项目中已安装并导入该库：

```bash
npm install --save @fortawesome/fontawesome-free
```

```typescript
// main.ts
import '@fortawesome/fontawesome-free/css/all.css'
```

**页面缓存**
组件支持通过keep-alive缓存指定页面，默认缓存Home页面。可以通过修改cachedViews数组来添加需要缓存的页面：

```typescript
const cachedViews = ref<string[]>(['Home', 'Search'])
```

布局组件与Vue Router深度集成，自动处理页面过渡和视图渲染，为COKFOOD应用提供了坚实的结构基础。

#### 15.6.2 PageContainer组件

PageContainer组件是一个功能丰富的页面容器组件，用于构建具有统一体验的页面布局。它包含头部导航栏、内容区域和底部操作区，并支持下拉刷新和加载更多等移动应用常见的交互模式。

**组件特性**

- 可定制头部：标题、返回按钮和操作区域插槽
- 下拉刷新：支持原生触摸交互的下拉刷新功能
- 无限滚动：内置的滚动到底部加载更多功能
- 灵活布局：可通过属性控制头部和底部的显示
- 插槽系统：提供多个插槽满足不同的内容组织需求
- 触摸优化：针对移动设备优化的滚动和触摸体验
- 自适应内容：根据内容多少自动调整布局

**使用示例**

```vue
<template>
  <PageContainer
    title="页面标题"
    :pullRefresh="true"
    :loadMore="true"
    :hasMore="hasMoreData"
    :isLoading="isLoading"
    @refresh="handleRefresh"
    @loadMore="handleLoadMore"
  >
    <!-- 头部操作区 -->
    <template #action>
      <i class="fas fa-ellipsis-v"></i>
    </template>

    <!-- 主要内容 -->
    <div>页面内容...</div>

    <!-- 底部操作区 -->
    <template #footer>
      <div class="footer-btn">
        <Button block>提交</Button>
      </div>
    </template>
  </PageContainer>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import PageContainer from '@/components/layout/PageContainer.vue'
import Button from '@/components/common/Button.vue'

const hasMoreData = ref(true)
const isLoading = ref(false)

// 处理下拉刷新
const handleRefresh = () => {
  // 刷新数据逻辑...
}

// 处理加载更多
const handleLoadMore = () => {
  // 加载更多数据逻辑...
}
</script>
```

**组件API**
| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| title | string | '' | 页面标题 |
| showBack | boolean | true | 是否显示返回按钮 |
| hasHeader | boolean | true | 是否显示页面头部 |
| hasFooter | boolean | false | 是否显示页面底部 |
| noPadding | boolean | false | 内容区域是否无内边距 |
| scrollable | boolean | true | 内容区域是否可滚动 |
| pullRefresh | boolean | false | 是否启用下拉刷新 |
| loadMore | boolean | false | 是否启用加载更多 |
| hasMore | boolean | true | 是否还有更多数据可加载 |
| isLoading | boolean | false | 是否正在加载更多数据 |

**事件**
| 事件名称 | 说明 | 参数 |
|---------|------|------|
| refresh | 下拉刷新触发时 | - |
| loadMore | 加载更多触发时 | - |
| scroll | 滚动时触发 | { scrollTop, scrollHeight, clientHeight } |

**插槽**
| 插槽名称 | 说明 |
|---------|------|
| default | 页面主要内容 |
| action | 头部右侧操作区域 |
| footer | 页面底部操作区域 |

通过访问 `/examples/page-container` 路由可以查看PageContainer组件的示例及其使用方法。该示例展示了下拉刷新、加载更多、自定义头部和底部等功能的使用方式。

## 16. Vant UI 集成

COKFOOD项目集成了Vant UI组件库，这是一个轻量、可靠的移动端Vue组件库，为项目提供了丰富的移动端UI组件和交互模式。

### 16.1 集成配置

Vant UI通过插件方式集成到项目中，实现了按需引入和全局配置：

```typescript
// src/plugins/vant.ts
import { App } from 'vue'
import { Button, Icon, NavBar /* 其他组件 */ } from 'vant'
import 'vant/lib/index.css'

export function setupVant(app: App<Element>): void {
  // 注册组件
  ;[Button, Icon, NavBar /* 其他组件 */].forEach((component) => {
    app.use(component)
  })

  // 注册指令
  app.use(Lazyload, {
    lazyComponent: true,
    loading: '/src/assets/images/loading-placeholder.png',
    error: '/src/assets/images/error-placeholder.png',
  })
}
```

### 16.2 使用的主要组件

COKFOOD项目中使用了以下Vant UI核心组件：

1. **基础组件**

   - Button：各种类型和样式的按钮
   - Icon：丰富的图标集合
   - Cell/CellGroup：列表项和分组
   - Image：图片组件，支持懒加载和占位图

2. **导航组件**

   - NavBar：顶部导航栏
   - Tabbar：底部标签栏
   - DropdownMenu：下拉菜单

3. **表单组件**

   - Form：表单容器
   - Field：表单输入项
   - Checkbox/Radio：选择组件
   - Stepper：步进器
   - Rate：评分组件

4. **展示组件**

   - Swipe：轮播组件
   - Tag：标签
   - Skeleton：骨架屏
   - Empty：空状态

5. **反馈组件**
   - Toast：轻提示
   - Dialog：对话框
   - Notify：通知
   - Loading：加载指示器
   - PullRefresh：下拉刷新
   - List：列表加载

### 16.3 使用方式

Vant组件可以直接在模板中使用，无需导入：

```vue
<template>
  <van-button type="primary">按钮</van-button>
  <van-cell-group>
    <van-cell title="单元格" value="内容" />
  </van-cell-group>
</template>
```

对于Toast、Dialog等交互组件，可以通过JS方式调用：

```typescript
import { Toast } from 'vant'

// 显示文字提示
Toast('提示内容')

// 显示成功提示
Toast.success('成功文案')

// 显示加载提示
Toast.loading('加载中...')
```

### 16.4 移动端适配

Vant UI组件库自带移动端适配方案，COKFOOD项目已进行了适配配置：

- 设计稿宽度：375px
- 支持响应式布局
- 使用viewport自适应方案

通过访问 `/examples/vant` 路由可以查看Vant UI组件的示例及其使用方法。该示例页面展示了按钮、表单、轮播图等常用组件的基本用法。

### 16.4 餐厅详情页 (RestaurantPage)

COKFOOD的餐厅详情页提供了直观、美观的餐厅和菜单展示，是用户探索餐厅菜品的主要界面。

#### 16.4.1 结构组成

- **餐厅封面区**：展示餐厅高质量封面图，底部有渐变遮罩层，显示餐厅名称、评分、配送时间和标签等信息
- **分类导航栏**：支持横向滚动的分类菜单，用户可快速跳转到不同菜品分类
- **菜单内容区**：按照分类组织的菜品列表，每个菜品项包含图片、名称、描述和价格
- **客户评价区**：展示餐厅的评价信息，包括整体评分、评分分布和客户评论

#### 16.4.2 功能特点

- **顶部下拉刷新**：通过PageContainer组件实现原生的下拉刷新体验，获取最新餐厅数据
- **分类锚点定位**：点击分类标签，自动平滑滚动到对应分类区域
- **粘性导航**：分类导航栏在滚动时固定在顶部，便于随时切换分类
- **菜品交互**：点击菜品可导航至商品详情页，悬停时有轻微动画效果
- **分类指示器**：当前选中分类通过颜色和下划线清晰标识
- **评价统计**：直观展示餐厅评分分布，使用水平条形图显示各评分占比
- **评价列表**：展示客户评价，包含用户头像、姓名、评分、时间和内容
- **加载更多**：支持点击加载更多历史评价，增强用户体验

#### 16.4.3 技术实现

- **动态路由参数**：通过`:id`参数获取并显示特定餐厅信息
- **TypeScript接口**：使用`RestaurantDetail`、`MenuItem`和`MenuCategory`等接口确保类型安全
- **响应式布局**：适配不同屏幕尺寸，保持良好的可读性和交互体验
- **BEM命名**：使用BEM命名规范，保持样式组织清晰
- **滚动优化**：使用`nextTick`和`scrollIntoView`实现平滑的分类切换
- **组件封装**：将评价功能封装为`RestaurantReviews`组件，提高代码复用性
- **SVG图标**：使用内联SVG实现星级评分图标，保证在各设备上的清晰度
- **异步加载**：评价数据采用分页加载方式，提高页面加载速度

#### 16.4.4 示例用法

```vue
<!-- 在首页餐厅卡片中使用 -->
<RestaurantCard :restaurant="restaurant" @click="navigateToRestaurant(restaurant)" />

<!-- 导航方法实现 -->
const navigateToRestaurant = (restaurant: Restaurant) => {
router.push(`/restaurant/${restaurant.id}`); };
```

餐厅详情页是COKFOOD用户体验的关键环节，通过精心设计的UI和流畅的交互，为用户提供了愉悦的餐厅探索和菜品选择体验。

## 17. 调试与问题排查

在COKFOOD项目的开发和维护过程中，可能会遇到一些常见问题。以下是一些常见问题及其解决方案：

### 17.1 空白页面问题

如果在访问应用时遇到空白页面，可能的原因包括：

1. **静态资源路径错误**：确保使用正确的资源路径

   ```typescript
   // 错误示例 - 绝对路径从src开始
   loading: '/src/assets/images/loading.png'

   // 正确示例 - 使用public文件夹中的资源
   loading: '/assets/images/loading.png'
   ```

2. **组件导入或注册错误**：检查组件是否正确导入和注册

   ```typescript
   // 确保使用正确的导入路径
   import AppLayout from '@/components/layout/AppLayout.vue'
   ```

3. **Vue错误**：检查浏览器控制台的错误信息，特别是关于未定义组件或属性的错误

4. **TypeScript类型错误**：使用类型声明而不是直接导入类型

   ```typescript
   // 错误
   import { App } from 'vue'

   // 正确
   import type { App } from 'vue'
   ```

5. **路由配置问题**：确保路由配置正确，特别是路径和组件引用

### 17.2 开发环境配置

本项目使用Vite作为构建工具，默认开发服务器运行在端口5173上。如果该端口被占用，Vite会自动使用下一个可用端口（如5174）：

```bash
# 启动开发服务器
npm run dev

# 输出示例
> cokfood@0.0.0 dev
> vite
Port 5173 is in use, trying another one...
  VITE v6.2.5  ready in 335 ms
  ➜  Local:   http://localhost:5174/
```

### 17.3 性能优化技巧

为提高应用性能，可以采取以下措施：

1. **组件懒加载**：使用动态导入延迟加载非关键组件

   ```typescript
   const SomeComponent = () => import('@/components/SomeComponent.vue')
   ```

2. **图片优化**：使用Vant的LazyLoad指令懒加载图片

   ```vue
   <van-image v-lazy="imageUrl" />
   ```

3. **组件缓存**：使用keep-alive缓存频繁访问的页面组件
   ```typescript
   const cachedViews = ref<string[]>(['Home', 'Search'])
   ```

## 16. 页面组件

### 16.1 首页布局 (HomePage)

COKFOOD首页是用户进入应用的第一站，采用了现代化的移动优先设计。首页布局包含以下主要部分：

#### 16.1.1 结构组成

- **顶部导航栏**：显示COKFOOD logo和当前配送地址，滚动时会自动切换透明/不透明效果
- **搜索栏**：点击可跳转到搜索页面
- **轮播区域**：展示促销活动和特色内容，带有指示器和过渡动画
- **分类导航**：横向滚动的食品分类图标，便于快速筛选餐厅
- **特色餐厅区**：展示推荐餐厅，以网格布局呈现
- **热门菜品区**：竖向滚动的菜品卡片，展示各餐厅热门商品

#### 16.1.2 功能特点

- **下拉刷新**：通过PageContainer组件实现原生的下拉刷新体验
- **滚动检测**：监听滚动位置，动态调整顶部导航栏样式
- **轮播自动播放**：首页轮播区和用户评价区支持自动轮播
- **组件复用**：使用RestaurantCard和DishCard组件展示内容，保持UI一致性
- **交互动效**：卡片悬停效果、图片缩放、轮播过渡等动画增强用户体验

### 16.2 餐厅卡片 (RestaurantCard)

餐厅卡片组件用于展示餐厅信息，具有以下特点：

- **响应式设计**：适配不同屏幕尺寸，保持美观与可读性
- **图片优化**：支持图片懒加载和加载失败占位图
- **交互效果**：悬停时卡片上移并增加阴影深度，图片轻微放大
- **信息展示**：包含餐厅名称、评分、配送时间、配送费和餐厅标签
- **布局美观**：采用卡片式设计，圆角和阴影提升精致感

示例用法：

```vue
<RestaurantCard :restaurant="restaurant" @click="navigateToRestaurant(restaurant)" />
```

### 16.3 菜品卡片 (DishCard)

菜品卡片组件用于展示餐厅内的菜品，具有以下特点：

- **紧凑布局**：适合横向滚动列表展示，一屏可显示多个菜品
- **价格与评分**：清晰展示价格和用户评分信息
- **餐厅归属**：显示菜品所属餐厅名称，建立关联性
- **美观效果**：卡片悬停动画和图片缩放效果增强交互体验
- **统一风格**：与整体设计保持一致的颜色、圆角和阴影风格

示例用法：

```vue
<DishCard :dish="dish" @click="navigateToDish(dish)" />
```

通过这些精心设计的页面组件，COKFOOD为用户提供了直观、美观且功能丰富的移动端体验，使用户能够轻松浏览餐厅和菜品，并快速完成点餐流程。

## 18. 开发日志与问题修复

### 18.1 2025-04-03 类型系统优化与SCSS变量问题修复

#### 18.1.1 TypeScript类型定义增强

为提高代码的类型安全性和可维护性，我们创建了`src/types/models.ts`文件，定义了以下核心业务模型接口：

```typescript
// 轮播图模型
export interface Banner {
  id: number
  title: string
  subtitle: string
  image: string
  link: string
}

// 食品分类模型
export interface Category {
  id: number
  name: string
  icon: string
}

// 餐厅模型
export interface Restaurant {
  id: number
  name: string
  image: string
  rating: number
  deliveryTime: string
  deliveryFee: string
  tags: string[]
}

// 菜品模型
export interface Dish {
  id: number
  name: string
  image: string
  price: number
  restaurantName: string
  restaurantId: number
  rating: number
}

// 用户评价模型
export interface Review {
  name: string
  avatar: string
  rating: number
  comment: string
}
```

这些类型定义被应用于`HomePage.vue`组件中，替换了之前使用的`any`类型，提升了代码的可读性和类型安全性。

#### 18.1.2 SCSS变量问题修复

在样式系统中，我们确认了`$border-radius-pill`变量的正确定义已存在于`variables.scss`文件中：

```scss
$border-radius-pill: 9999px; // 与full相同，用于保持命名一致性
```

该变量在`HomePage.vue`和`RestaurantCard.vue`组件中被正确引用，用于实现圆形和胶囊形状的UI元素。通过确保变量的正确引用，解决了开发服务器启动时报告的SCSS编译错误。

#### 18.1.3 组件同步与优化

随着类型系统的完善，我们进一步优化了`HomePage.vue`组件中的各个方法，确保它们使用正确的类型约束：

```typescript
const handleBannerClick = (banner: Banner) => {
  router.push(banner.link)
}

const navigateToCategory = (category: Category) => {
  router.push(`/category/${category.id}`)
}

const navigateToRestaurant = (restaurant: Restaurant) => {
  router.push(`/restaurant/${restaurant.id}`)
}

const navigateToDish = (dish: Dish) => {
  router.push(`/product/${dish.id}`)
}
```

通过这些优化，我们改善了代码的可维护性和类型安全性，同时解决了开发环境中出现的编译错误。

### 18.4 订单结算页面SASS变量错误修复

#### 18.4.1 问题描述

在实现订单结算页面时，遇到了SASS编译错误：

```
[sass] Undefined variable.
    ╷
279 │       color: $accent;
    │              ^^^^^^^
    ╵
  src\views\order\CheckoutPage.vue 279:14  root stylesheet
```

错误原因是在 `CheckoutPage.vue` 文件中使用了未在 `variables.scss` 中定义的 `$accent` 变量。这个变量在配送时间估计图标的颜色样式中被引用：

```scss
&__delivery-time {
  display: flex;
  align-items: center;
  font-size: $font-size-xs;
  color: $text-secondary;

  i {
    margin-right: $spacing-xs;
    color: $accent; // 未定义的变量
  }
}
```

#### 18.4.2 解决方案

我们将未定义的 `$accent` 变量替换为已定义的 `$warning` 变量：

```scss
i {
  margin-right: $spacing-xs;
  color: $warning; // 修改为已定义的变量
}
```

#### 18.4.3 经验教训

在开发过程中，应该确保使用的所有SCSS变量都已在全局变量文件中定义，或考虑在组件内定义局部变量。这有助于避免编译错误并保持样式的一致性。

## 19. 错误修复日志

### 19.1 2023-04-04 个人中心页面404错误修复

#### 19.1.1 问题描述

在用户登录后访问个人中心页面（http://localhost:5173/profile）时，系统显示404错误页面。通过排查发现以下问题：

1. 虽然在`router/index.ts`中已正确配置了个人中心页面路由：

   ```typescript
   {
     path: '/profile',
     name: 'Profile',
     component: () => import('@/views/profile/ProfilePage.vue'),
     meta: {
       title: 'My Profile'
     }
   }
   ```

2. 并且`src/views/profile/ProfilePage.vue`文件也已创建并实现，但页面依然无法正常访问。

#### 19.1.2 问题分析

深入分析发现，`ProfilePage.vue`组件中引用了`EditProfileModal`组件：

```typescript
import EditProfileModal from '@/components/profile/EditProfileModal.vue'
```

但是`EditProfileModal.vue`文件虽然存在于`src/components/profile/`目录下，却是一个空文件，导致编译失败，从而无法正确渲染个人中心页面。

#### 19.1.3 解决方案

1. 完整实现了`src/components/profile/EditProfileModal.vue`组件，包括：

   - 模态框UI设计
   - 表单交互逻辑
   - 头像上传功能
   - 表单提交处理

2. 在`ProfilePage.vue`中正确引用和集成`EditProfileModal`组件：
   - 添加模态框显示状态管理
   - 实现模态框打开/关闭逻辑
   - 添加用户资料更新方法

#### 19.1.4 验证与测试

修复完成后，重新启动开发服务器，成功访问了个人中心页面，并验证了以下功能：

- 未登录状态下显示登录提示
- 已登录状态下显示用户信息和功能菜单
- 点击"Edit Profile"按钮弹出编辑个人资料模态框
- 更新个人资料保存到用户存储

该修复确保了个人中心页面正常工作，同时完善了编辑个人资料的功能，增强了用户体验。

### 19.2 2023-04-05 node_modules中Sass相关错误修复

#### 19.2.1 问题描述

项目中出现大量TypeScript错误，主要报告来自node_modules文件夹内sass相关文件，导致编译失败和页面无法正常加载。错误信息显示约有886个相关错误，严重影响了开发流程。

#### 19.2.2 问题分析

通过分析错误日志，发现主要存在以下问题：

1. **TypeScript类型错误**：在EditProfileModal.vue组件中的formData定义与props.userData类型不匹配：

   ```typescript
   // 错误代码
   const formData = ref({
     name: '',
     email: '',
     phone: '',
     avatar: '',
   })

   // 错误发生在这里
   formData.value = { ...props.userData }
   ```

   问题在于formData中的avatar被定义为必选字符串，而props.userData中是可选字符串。

2. **TypeScript检查node_modules**：默认配置下，TypeScript尝试检查node_modules目录中的所有文件，导致大量第三方库文件被检查并报错。

3. **Sass版本兼容性问题**：项目使用的Sass版本与Node.js版本可能存在兼容性问题，导致编译报错。

#### 19.2.3 解决方案

针对上述问题，采取了以下修复措施：

1. **更新TypeScript配置**：

   - 修改`tsconfig.app.json`，添加`skipLibCheck: true`选项
   - 在`exclude`配置中明确排除`node_modules/**/*`

   ```json
   {
     "exclude": ["src/**/__tests__/*", "node_modules/**/*"],
     "compilerOptions": {
       "skipLibCheck": true,
       "composite": true,
       ...
     }
   }
   ```

2. **修复类型错误**：

   - 更新EditProfileModal.vue中的formData定义，使avatar类型与userData保持一致

   ```typescript
   const formData = ref({
     name: '',
     email: '',
     phone: '',
     avatar: '' as string | undefined,
   })
   ```

3. **更新Sass依赖**：

   - 安装最新版本的Sass作为开发依赖

   ```bash
   npm install -D sass@latest
   ```

4. **清除缓存**：
   - 删除node_modules/.cache目录，确保清除所有可能的缓存文件
   - 使用`--force`选项重新启动开发服务器

#### 19.2.4 成果与教训

修复后，虽然仍有一些Sass弃用警告（如使用@import而非@use，使用darken()而非color.adjust()），但这些只是警告而非错误，不影响应用正常运行。

主要教训：

- 项目应明确配置TypeScript不检查node_modules目录
- 组件中的类型定义应与传入props保持一致
- 当遇到大量编译错误时，可先尝试清除缓存
- 依赖版本升级（如Sass）可能需要更新相关代码以适配新版本

## 20. 搜索页面

COKFOOD搜索页面是一个功能强大的界面，允许用户搜索餐厅和菜品。该页面采用了直观的用户界面和流畅的交互体验，帮助用户快速找到他们想要的食物。

### 20.1 页面功能

#### 20.1.1 搜索功能

- **实时搜索**：输入时即时显示搜索建议
- **搜索历史**：记录并显示用户的历史搜索记录
- **搜索建议**：基于输入提供智能搜索建议
- **分类搜索**：支持按餐厅或菜品分类查看结果
- **结果计数**：显示找到的结果数量

#### 20.1.2 筛选功能

- **多维度筛选**：支持按评分、价格范围、菜系等筛选
- **排序选项**：支持多种排序方式（相关性、评分、价格等）
- **价格范围筛选**：通过价格等级筛选结果
- **菜系选择**：支持多选菜系类型

#### 20.1.3 结果展示

- **分类标签页**：结果分为"全部"、"餐厅"和"菜品"三个标签页
- **餐厅卡片**：展示餐厅图片、名称、评分、配送时间和标签
- **菜品卡片**：展示菜品图片、名称、所属餐厅、价格和评分
- **无结果提示**：当没有找到匹配结果时显示友好提示
- **加载更多**：支持分页加载更多结果

### 20.2 页面交互

#### 20.2.1 基础交互

- **返回按钮**：回到上一页
- **下拉刷新**：支持下拉刷新获取最新数据
- **加载动画**：加载更多时显示加载指示器
- **空状态处理**：无结果时提供返回首页的选项

#### 20.2.2 高级交互

- **筛选模态框**：底部弹出的筛选选项面板
- **历史记录管理**：支持清除单条或全部历史记录
- **搜索建议选择**：点击建议项直接执行搜索
- **标签切换**：平滑切换不同类型的搜索结果

### 20.3 数据存储

- **本地存储**：搜索历史记录保存在localStorage中
- **会话维护**：保持用户的筛选偏好在会话中
- **缓存管理**：最多保留10条历史记录

### 20.4 性能优化

- **懒加载图片**：提高页面加载速度
- **节流搜索**：避免频繁API调用导致的性能问题
- **分页加载**：结果分批加载，减轻服务器压力
- **状态管理**：高效管理搜索状态和结果缓存

搜索页面是COKFOOD应用的核心功能之一，提供了强大而直观的搜索体验，帮助用户快速找到他们想要的餐厅和菜品。页面设计注重用户体验，融合了现代交互设计和高效的数据处理，确保搜索流程简洁明了。

## 21. 订单页面

COKFOOD订单页面提供了直观、高效的订单管理体验，用户可以轻松查看和跟踪所有当前和历史订单，管理订单状态，并进行重新下单操作。

### 21.1 订单列表页面功能

#### 21.1.1 页面结构

- **登录状态检测**：自动检测用户是否登录，未登录用户显示登录提示
- **标签页设计**：采用"当前订单"和"历史订单"双标签页布局
- **订单卡片展示**：每张卡片包含餐厅信息、订单状态、菜品明细和操作按钮
- **下拉刷新**：支持下拉刷新获取最新订单信息
- **加载更多**：历史订单支持滚动加载更多功能

#### 21.1.2 订单状态管理

- **视觉化状态标签**：使用不同颜色区分各种订单状态（准备中、配送中、已送达、已取消）
- **进度条指示器**：直观显示订单处理阶段和进度
- **状态节点展示**：清晰标记下单、准备中、配送中和已送达四个关键节点

#### 21.1.3 订单操作功能

- **跟踪订单**：准备中和配送中状态的订单提供跟踪功能
- **重新下单**：已完成订单提供一键重新下单功能，自动将菜品添加到购物车
- **订单详情访问**：点击订单卡片进入详细信息页面

### 21.2 订单详情页面功能

#### 21.2.1 页面结构

- **订单基本信息**：订单号、下单时间、餐厅名称和订单状态
- **菜品明细列表**：详细展示所有菜品名称、数量和价格
- **费用明细**：小计、配送费、税费和最终总价的清晰计算
- **配送地址信息**：显示订单的配送地址
- **进度跟踪**：配送状态实时进度条和节点标记

#### 21.2.2 订单操作功能

- **跟踪订单**：对进行中的订单提供跟踪按钮
- **重新下单**：对已完成订单提供重新下单功能
- **取消订单**：对准备中的订单提供取消功能，含取消确认流程
- **操作确认**：关键操作（如取消订单）提供二次确认机制

#### 21.2.3 交互体验优化

- **状态颜色编码**：使用一致的颜色系统表示不同订单状态
- **动画过渡效果**：模态框开关使用平滑过渡动画
- **按钮反馈**：所有按钮提供清晰的点击反馈
- **二次确认保护**：重要操作（如取消订单）提供明确的确认步骤

### 21.3 技术实现

#### 21.3.1 组件设计

- **模块化结构**：订单列表和详情使用独立组件构建
- **响应式布局**：适配不同屏幕尺寸的流畅体验
- **状态管理**：使用Pinia进行订单状态的集中管理
- **数据缓存**：实现订单数据的本地缓存，减少网络请求

#### 21.3.2 性能优化

- **懒加载策略**：历史订单采用分页加载机制
- **组件复用**：订单卡片和状态标签实现为可复用组件
- **条件渲染**：基于订单状态的智能条件渲染
- **轻量级动画**：使用CSS过渡而非重JavaScript动画

### 21.4 用户体验亮点

- **直观状态指示**：通过颜色和进度条直观反映订单状态
- **简化操作流程**：关键操作（跟踪、重新下单）一步可达
- **无结果状态处理**：无订单时提供友好的空状态提示和引导
- **错误恢复机制**：操作失败时提供清晰的错误提示和恢复路径

订单页面作为用户管理和跟踪订单的核心界面，通过清晰的信息组织、直观的状态展示和便捷的操作功能，为用户提供了高效且愉悦的订单管理体验。

## 22. 图表示例页面

COKFOOD图表示例页面展示了使用Vue ApexCharts集成的各种数据可视化示例，为开发者提供了清晰的数据展示参考。此页面可通过 `/example/chart` 路径访问。

### 22.1 图表类型展示

#### 22.1.1 条形图

- **功能**：展示每周订单数量的条形图
- **交互**：支持悬停查看详细数据
- **颜色**：使用主题主色调增强视觉识别性
- **格式化**：包含自定义数据标签格式化

#### 22.1.2 饼图

- **功能**：展示不同食品类别分布的饼图
- **分类**：包括汉堡、披萨、寿司、沙拉和饮料
- **响应式设计**：在小屏幕设备上自动调整布局
- **图例位置**：在较小屏幕上移至底部以优化空间

#### 22.1.3 折线图

- **功能**：展示月度营收趋势的平滑折线图
- **标记点**：在每个数据点添加突出显示的标记
- **悬停效果**：标记点在悬停时增大，增强交互性
- **数据格式化**：金额数据以千位单位展示

#### 22.1.4 面积图

- **功能**：展示新用户和回访用户数量的堆叠面积图
- **渐变填充**：使用渐变色增强视觉效果
- **曲线平滑**：平滑的数据线条提供更优雅的视觉体验
- **多数据系列**：同时展示多个相关数据系列的比较

### 22.2 技术实现

- **组件库**：使用Vue ApexCharts，集成灵活的图表配置选项
- **数据交互**：所有图表支持悬停查看详情
- **自定义主题**：图表颜色与COKFOOD设计系统保持一致
- **响应式设计**：图表自动适应不同屏幕尺寸

## 23. 首页页面优化

首页是COKFOOD应用的核心入口，我们对其进行了全面深度优化，提供了更现代化、直观和美观的用户体验。此次优化注重视觉效果、交互体验和性能表现，完全重新设计了布局和样式，同时保持了原有功能的完整性。

### 23.1 视觉设计优化

#### 23.1.1 整体设计风格

- **现代简约设计**：采用清爽的背景色和大胆的视觉元素，营造现代感和专业性
- **视觉层次增强**：通过阴影深度、色彩对比和空间分隔，创造清晰的内容视觉层次
- **精致动效**：添加微妙的悬停效果、过渡动画和交互反馈，提升用户体验
- **一致性设计语言**：所有组件和元素遵循统一的设计语言，确保体验的连贯性

#### 23.1.2 组件优化

- **导航栏**：添加了背景模糊效果和平滑渐变，滚动时更自然地融入页面
- **搜索框**：放大尺寸并添加悬停效果，增强可见性和可点击感
- **轮播区**：增加高度、优化阴影效果、添加文字阴影，使内容更加突出
- **分类图标**：采用圆角矩形代替圆形，增加视觉新鲜感，同时添加悬停动效
- **内容标题**：添加下划线装饰，强化视觉锚点作用
- **餐厅卡片**：保持原有布局，优化阴影和悬停效果

### 23.2 结构布局调整

#### 23.2.1 移除模块

- **移除"如何工作"区域**：简化页面结构，专注于核心内容展示
- **移除"用户评价"区域**：减少页面长度，提高重要内容的可见性

#### 23.2.2 热门菜品改版

- **垂直网格布局**：将原横向滚动列表改为垂直网格布局，更符合内容浏览习惯
- **响应式列数**：在不同屏幕宽度下自动调整列数（小屏2列，大屏3列）
- **无限加载功能**：实现"加载更多"按钮，支持分页加载更多菜品
- **加载状态指示**：添加加载中动画，提供良好的视觉反馈

### 23.3 交互体验增强

#### 23.3.1 微交互优化

- **卡片悬停效果**：餐厅卡片和菜品卡片添加精细的悬停动画
- **按钮反馈**：所有可点击元素增加明确的视觉反馈
- **图像缩放**：图片在悬停时有轻微放大效果，增强沉浸感
- **平滑过渡**：所有状态变化都通过平滑过渡实现，避免生硬的视觉跳跃

#### 23.3.2 性能优化

- **懒加载实现**：分批加载热门菜品，减少初始加载数据量
- **减少DOM节点**：移除不必要模块，降低页面复杂度
- **CSS优化**：采用更高效的CSS选择器和动画实现
- **骨架屏设计**：为加载中的内容提供占位视图，减少体验断层

### 23.4 技术实现细节

#### 23.4.1 代码组织

- **computed属性**：使用计算属性管理显示的菜品数据
- **模块化状态**：清晰分离不同功能模块的状态管理
- **语义化命名**：使用更清晰的变量名和函数名，提高代码可读性
- **中文注释**：为主要功能块添加中文注释，便于维护

#### 23.4.2 响应式设计

- **弹性布局**：所有元素采用弹性布局，适应不同屏幕尺寸
- **媒体查询**：针对不同设备优化布局和组件尺寸
- **自适应容器**：菜品网格在大屏幕上自动增加列数
- **触控优化**：所有交互元素尺寸适合触控操作，提升移动体验

通过这些深度优化，COKFOOD首页不仅在视觉上更加精美现代，在用户体验和性能方面也有了显著提升。垂直布局的热门菜品展示与无限加载的结合，为用户提供了更直观、高效的内容浏览方式，同时简化的页面结构使关键内容更加突出，帮助用户快速找到所需信息。
